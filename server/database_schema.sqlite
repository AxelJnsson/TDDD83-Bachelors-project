DROP TABLE IF EXISTS product;
DROP TABLE IF EXISTS user;
DROP TABLE IF EXISTS used_product ;
DROP TABLE IF EXISTS new_product ;

SELECT 'Creating tables' AS 'Message';



CREATE TABLE IF NOT EXISTS product (
product_id INTEGER PRIMARY KEY AUTOINCREMENT,
brand TEXT NOT NULL,
model TEXT NOT NULL,
name TEXT NOT NULL,
price INTEGER NOT NULL,
color TEXT NOT NULL,
year INTEGER NOT NULL,
type TEXT NOT NULL,
new_or_not INTEGER NOT NULL,
seller INTEGER NOT NULL 
);

CREATE TABLE user (
    user_id INTEGER,
    email TEXT NOT NULL UNIQUE,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    is_admin INTEGER DEFAULT 0,
    password_hash TEXT NOT NULL,
    CONSTRAINT pk_user PRIMARY KEY (user_id)
);

CREATE TABLE  used_product (
    product_id INTEGER PRIMARY KEY,
    user_id INTEGER, 
    FOREIGN KEY(product_id) REFERENCES product(product_id),
    FOREIGN KEY(user_id) REFERENCES user(user_id)
);

CREATE TABLE new_product (
  product_id INTEGER PRIMARY KEY,
FOREIGN KEY(product_id) REFERENCES product(product_id)
);

CREATE TRIGGER insertIntoNew
AFTER INSERT ON product
WHEN new_or_not = 1
BEGIN
INSERT INTO new_product(product_id)
VALUES(NEW.product_id);
END;

CREATE TRIGGER insertIntoOld
AFTER INSERT ON product
WHEN new_or_not = 0
BEGIN
INSERT INTO used_product(product_id, user_id)
SELECT NEW.product_id, B.user_id
FROM product, user B
WHERE B.user_id = NEW.seller 
END ;
